<!DOCTYPE>
<html>
	<head>
		<title>Getting coords for particles</title>
		<script type="text/javascript">

			function rand(min, max) {
				var rand = min - 0.5 + Math.random() * (max - min + 1)
				rand = Math.round(rand);
				return rand;
			}

			function randRange(amplitude) {
				return Math.random() * 2 * amplitude - amplitude;
			}

			function getDataFromImage(image)
			{
				var cnvs = document.createElement('canvas');
				var context = cnvs.getContext('2d');
				cnvs.width = image.width;
				cnvs.height = image.height;
				context.drawImage(image, 0, 0 );
				return context.getImageData(0, 0, image.width, image.height);
			}

			var dots = new Array();
			var img = new Image();
			var imgData;

			function init()
			{
				for(i=0;i<5000;i++)
				{
					dots[i] = new Object();
					dots[i].whereX = dots[i].x;
					dots[i].whereY = dots[i].y;
				}

				img.src = "5.bmp";
				img.onload = function() {
					imgData = getDataFromImage(img);
					setDots();
				};
			}

			function setDots()
			{
				var k = 0;
				var str = "";
				
				for (var i=0; i<imgData.height; i+=5)
					for (var j=0; j<imgData.width; j+=5)
					{
						if (imgData.data[(i*imgData.width+j)*4] == 0)
						{
							dots[k].whereY = i;
							dots[k].whereX = j;
							str += "dots["+k+"].whereY="+i+"; dots["+k+"].whereX="+j+"; ";
							k++;
						}
					}

				str = "var oldMax = dotsMax;<br/>initDots("+k+");<br/>" + str + "<br/>setDots(oldMax, "+k+");";
				var code = document.getElementById('code');
				code.innerHTML = str;

				var image = document.getElementById('image');
				image.innerHTML = img.src;
			}

		</script>
		<style type="text/css">
			canvas { border: 1px solid black; }
		</style>
	</head>
	<body onload="init();">
		<h1>Getting coords for particles</h1>
		<div id="image" margin="50px"></div>
		<div id="code"></div>
	</body>
</html>