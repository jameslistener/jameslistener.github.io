<!DOCTYPE>
<html>
	<head>
		<title>Getting coords for particles</title>
		<script type="text/javascript">

			function rand(min, max) {
				var rand = min - 0.5 + Math.random() * (max - min + 1)
				rand = Math.round(rand);
				return rand;
			}

			function randRange(amplitude) {
				return Math.random() * 2 * amplitude - amplitude;
			}

			function getDataFromImage(image)
			{
				var cnvs = document.createElement('canvas');
				var context = cnvs.getContext('2d');
				cnvs.width = image.width;
				cnvs.height = image.height;
				context.drawImage(image, 0, 0 );
				return context.getImageData(0, 0, image.width, image.height);
			}

			var dots = new Array();
			var img1 = new Image();
			var img2 = new Image();
			var img3 = new Image();
			var img4 = new Image();
			var img5 = new Image();
			var img6 = new Image();
			var img7 = new Image();
			var img8 = new Image();
			var img9 = new Image();
			var img10 = new Image();
			var img11 = new Image();
			var img12 = new Image();
			var imgData1;
			var imgData2;
			var imgData3;
			var imgData4;
			var imgData5;
			var imgData6;
			var imgData7;
			var imgData8;
			var imgData9;
			var imgData10;
			var imgData11;
			var imgData12;

			function init()
			{
				for(i=0;i<5000;i++)
				{
					dots[i] = new Object();
					dots[i].whereX = dots[i].x;
					dots[i].whereY = dots[i].y;
				}

				img1.src = "0.bmp";
				var image1 = document.getElementById('image1');
				image1.innerHTML = img1.src;
				var code1 = document.getElementById('code1');
				img1.onload = function() {
					imgData1 = getDataFromImage(img1);
					setDots(code1);
				};
				
				img2.src = "1.bmp";
				var image2 = document.getElementById('image2');
				image2.innerHTML = img2.src;
				var code2 = document.getElementById('code2');
				img2.onload = function() {
					imgData2 = getDataFromImage(img2);
					setDots(code2);
				};

				img3.src = "2.bmp";
				var image3 = document.getElementById('image3');
				image3.innerHTML = img3.src;
				var code3 = document.getElementById('code3');
				img3.onload = function() {
					imgData3 = getDataFromImage(img3);
					setDots(code3);
				};

				img4.src = "3.bmp";
				var image4 = document.getElementById('image4');
				image4.innerHTML = img4.src;
				var code4 = document.getElementById('code4');
				img4.onload = function() {
					imgData4 = getDataFromImage(img4);
					setDots(code4);
				};

				img5.src = "4.bmp";
				var image5 = document.getElementById('image5');
				image5.innerHTML = img5.src;
				var code5 = document.getElementById('code5');
				img5.onload = function() {
					imgData5 = getDataFromImage(img5);
					setDots(code5);
				};

				img6.src = "5.bmp";
				var image6 = document.getElementById('image6');
				image6.innerHTML = img6.src;
				var code6 = document.getElementById('code6');
				img6.onload = function() {
					imgData6 = getDataFromImage(img6);
					setDots(code6);
				};

				img7.src = "kate.bmp";
				var image7 = document.getElementById('image7');
				image7.innerHTML = img7.src;
				var code7 = document.getElementById('code7');
				img7.onload = function() {
					imgData7 = getDataFromImage(img7);
					setDots(code7);
				};

				img8.src = "happybirthday.bmp";
				var image8 = document.getElementById('image8');
				image8.innerHTML = img8.src;
				var code8 = document.getElementById('code8');
				img8.onload = function() {
					imgData8 = getDataFromImage(img8);
					setDots(code8);
				};

				img9.src = "love.bmp";
				var image9 = document.getElementById('image9');
				image9.innerHTML = img9.src;
				var code9 = document.getElementById('code9');
				img9.onload = function() {
					imgData9 = getDataFromImage(img9);
					setDots(code9);
				};

				img10.src = "heart.bmp";
				var image10 = document.getElementById('image10');
				image10.innerHTML = img10.src;
				var code10 = document.getElementById('code10');
				img10.onload = function() {
					imgData10 = getDataFromImage(img10);
					setDots(code10);
				};

				img11.src = "kate_face2.bmp";
				var image11 = document.getElementById('image11');
				image11.innerHTML = img11.src;
				var code11 = document.getElementById('code11');
				img11.onload = function() {
					imgData11 = getDataFromImage(img11);
					setDots(code11);
				};

				img12.src = "me.bmp";
				var image12 = document.getElementById('image12');
				image12.innerHTML = img12.src;
				var code12 = document.getElementById('code12');
				img12.onload = function() {
					imgData12 = getDataFromImage(img12);
					setDots(code12);
				};
			}

			function setDots(code)
			{
				var k = 0;
				var str = "";
				
				for (var i=0; i<imgData.height; i+=5)
					for (var j=0; j<imgData.width; j+=5)
					{
						if (imgData.data[(i*imgData.width+j)*4] <= 100)
						{
							dots[k].whereY = i;
							dots[k].whereX = j;
							str += "dots["+k+"].whereY="+i+"; dots["+k+"].whereX="+j+"; ";
							k++;
						}
					}

				str = "var oldMax = dotsMax;<br/>initDots("+k+");<br/>" + str + "<br/>setDots(oldMax, "+k+");";
				
				code.innerHTML = str;
			}

		</script>
		<style type="text/css">
			canvas { border: 1px solid black; }
		</style>
	</head>
	<body onload="init();">
		<h1>Getting coords for particles</h1>
		<div id="image1" margin="50px"></div>
		<div id="code1"></div>
		<div id="image2" margin="50px"></div>
		<div id="code2"></div>
		<div id="image3" margin="50px"></div>
		<div id="code3"></div>
		<div id="image4" margin="50px"></div>
		<div id="code4"></div>
		<div id="image5" margin="50px"></div>
		<div id="code5"></div>
		<div id="image6" margin="50px"></div>
		<div id="code6"></div>
		<div id="image7" margin="50px"></div>
		<div id="code7"></div>
		<div id="image8" margin="50px"></div>
		<div id="code8"></div>
		<div id="image9" margin="50px"></div>
		<div id="code9"></div>
		<div id="image10" margin="50px"></div>
		<div id="code10"></div>
		<div id="image11" margin="50px"></div>
		<div id="code11"></div>
		<div id="image12" margin="50px"></div>
		<div id="code12"></div>
	</body>
</html>