<!DOCTYPE>
<html>
	<head>
		<title>Getting coords for particles</title>
		<script type="text/javascript">

			function rand(min, max) {
				var rand = min - 0.5 + Math.random() * (max - min + 1)
				rand = Math.round(rand);
				return rand;
			}

			function randRange(amplitude) {
				return Math.random() * 2 * amplitude - amplitude;
			}

			function getDataFromImage(image)
			{
				var cnvs = document.createElement('canvas');
				var context = cnvs.getContext('2d');
				cnvs.width = image.width;
				cnvs.height = image.height;
				context.drawImage(image, 0, 0 );
				return context.getImageData(0, 0, image.width, image.height);
			}

			var dots = new Array();
			var img = new Image();
			var imgData;

			function init()
			{
				for(i=0;i<5000;i++)
				{
					dots[i] = new Object();
					dots[i].whereX = dots[i].x;
					dots[i].whereY = dots[i].y;
				}

				img.src = "0.bmp";
				var image = document.getElementById('image1');
				image.innerHTML = img.src;
				var code = document.getElementById('code1');
				img.onload = function() {
					imgData = getDataFromImage(img);
					setDots(code);
				};
				
				img.src = "1.bmp";
				var image = document.getElementById('image2');
				image.innerHTML = img.src;
				var code = document.getElementById('code2');
				img.onload = function() {
					imgData = getDataFromImage(img);
					setDots(code);
				};

				img.src = "2.bmp";
				var image = document.getElementById('image3');
				image.innerHTML = img.src;
				var code = document.getElementById('code3');
				img.onload = function() {
					imgData = getDataFromImage(img);
					setDots(code);
				};

				img.src = "3.bmp";
				var image = document.getElementById('image4');
				image.innerHTML = img.src;
				var code = document.getElementById('code4');
				img.onload = function() {
					imgData = getDataFromImage(img);
					setDots(code);
				};

				img.src = "4.bmp";
				var image = document.getElementById('image5');
				image.innerHTML = img.src;
				var code = document.getElementById('code5');
				img.onload = function() {
					imgData = getDataFromImage(img);
					setDots(code);
				};

				img.src = "5.bmp";
				var image = document.getElementById('image6');
				image.innerHTML = img.src;
				var code = document.getElementById('code6');
				img.onload = function() {
					imgData = getDataFromImage(img);
					setDots(code);
				};

				img.src = "kate.bmp";
				var image = document.getElementById('image7');
				image.innerHTML = img.src;
				var code = document.getElementById('code7');
				img.onload = function() {
					imgData = getDataFromImage(img);
					setDots(code);
				};

				img.src = "happybirthday.bmp";
				var image = document.getElementById('image8');
				image.innerHTML = img.src;
				var code = document.getElementById('code8');
				img.onload = function() {
					imgData = getDataFromImage(img);
					setDots(code);
				};

				img.src = "love.bmp";
				var image = document.getElementById('image9');
				image.innerHTML = img.src;
				var code = document.getElementById('code9');
				img.onload = function() {
					imgData = getDataFromImage(img);
					setDots(code);
				};

				img.src = "heart.bmp";
				var image = document.getElementById('image10');
				image.innerHTML = img.src;
				var code = document.getElementById('code10');
				img.onload = function() {
					imgData = getDataFromImage(img);
					setDots(code);
				};

				img.src = "kate_face2.bmp";
				var image = document.getElementById('image11');
				image.innerHTML = img.src;
				var code = document.getElementById('code11');
				img.onload = function() {
					imgData = getDataFromImage(img);
					setDots(code);
				};

				img.src = "me.bmp";
				var image = document.getElementById('image12');
				image.innerHTML = img.src;
				var code = document.getElementById('code12');
				img.onload = function() {
					imgData = getDataFromImage(img);
					setDots(code);
				};
			}

			function setDots(code)
			{
				var k = 0;
				var str = "";
				
				for (var i=0; i<imgData.height; i+=5)
					for (var j=0; j<imgData.width; j+=5)
					{
						if (imgData.data[(i*imgData.width+j)*4] <= 100)
						{
							dots[k].whereY = i;
							dots[k].whereX = j;
							str += "dots["+k+"].whereY="+i+"; dots["+k+"].whereX="+j+"; ";
							k++;
						}
					}

				str = "var oldMax = dotsMax;<br/>initDots("+k+");<br/>" + str + "<br/>setDots(oldMax, "+k+");";
				
				code.innerHTML = str;
			}

		</script>
		<style type="text/css">
			canvas { border: 1px solid black; }
		</style>
	</head>
	<body onload="init();">
		<h1>Getting coords for particles</h1>
		<div id="image1" margin="50px"></div>
		<div id="code1"></div>
		<div id="image2" margin="50px"></div>
		<div id="code2"></div>
		<div id="image3" margin="50px"></div>
		<div id="code3"></div>
		<div id="image4" margin="50px"></div>
		<div id="code4"></div>
		<div id="image5" margin="50px"></div>
		<div id="code5"></div>
		<div id="image6" margin="50px"></div>
		<div id="code6"></div>
		<div id="image7" margin="50px"></div>
		<div id="code7"></div>
		<div id="image8" margin="50px"></div>
		<div id="code8"></div>
		<div id="image9" margin="50px"></div>
		<div id="code9"></div>
		<div id="image10" margin="50px"></div>
		<div id="code10"></div>
		<div id="image11" margin="50px"></div>
		<div id="code11"></div>
		<div id="image12" margin="50px"></div>
		<div id="code12"></div>
	</body>
</html>